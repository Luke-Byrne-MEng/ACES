<?xml version="1.0"?>
<launch>
  <!-- No namespace here as we will share this description. 
       Access with slash at the beginning -->
  <param name="robot_description"
    command="$(find xacro)/xacro $(find jet_description)/urdf/multi_robot.xacro" />

  <!-- Map Merge -->
  <node pkg="multirobot_map_merge" type="map_merge" respawn="false" name="map_merge" output="screen">
    <param name="robot_map_topic" value="map"/>
    <param name="robot_map_updates_topic" value="map_updates"/>
    <param name="robot_namespace" value="robot_"/>
    <param name="merged_map_topic" value="map"/>
    <param name="world_frame" value="/map"/>
    <param name="known_init_poses" value="false"/>
    <param name="merging_rate" value="4.0"/>
    <param name="discovery_rate" value="0.05"/>
    <param name="estimation_rate" value="0.5"/>
    <param name="publish_rate" value="1.0"/>
    <param name="estimation_confidence" value="0.25"/>
  </node>
  <!-- Map Broadcaster -->
  <node pkg="tf" type="static_transform_publisher" name="world_to_robot_1_tf_broadcaster"  args="0 0 0 0 0 0 /map /robot_1/map 100"/>
  <node pkg="tf" type="static_transform_publisher" name="world_to_robot_2_tf_broadcaster"  args="0 0 0 0 0 0 /map /robot_2/map 100"/>
  <node pkg="tf" type="static_transform_publisher" name="world_to_robot_3_tf_broadcaster"  args="0 0 0 0 0 0 /map /robot_3/map 100"/>			

  <!-- ...........................BEGIN ROBOT 1....................................-->
  <group ns="robot_1">
    <param name="tf_prefix" value="robot_1" />
    <include file="$(find multi_robot)/launch/jet_setup.launch" >
      <arg name="init_pose" value="-x -8 -y 7 -z 0 -R 0 -P 0 -Y 0" />
      <arg name="robot_name"  value="robot_1" />
    </include>
    <!-- Gmapping Node -->
    <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
      <param name="base_frame" value="/robot_1/Main_Frame"/>
      <param name="odom_frame" value="/robot_1/odom"/>
      <param name="map_frame"  value="/robot_1/map"/>
      <remap from="scan" to="/robot_1/laser/scan"/>
      <remap from="map" to="/robot_1/map" />
      <rosparam command="load" file="$(find jet_slam)/config/gmapping_params.yaml" />
    </node>
    <!-- MoveBase Node -->
    <include file="$(find multi_robot)/config/move_base_setup.launch">
      <arg name="namespace" value="robot_1"/>
    </include>
    <!-- Explore-Lite Node -->
    <include file="$(find multi_robot)/config/exploration_setup.launch">
      <arg name="namespace" value="robot_1"/>
    </include>   
  </group>

  <!-- ...........................BEGIN ROBOT 2....................................-->
  <group ns="robot_2">
    <param name="tf_prefix" value="robot_2" />
    <include file="$(find multi_robot)/launch/jet_setup.launch" >
      <arg name="init_pose" value="-x -8 -y -7 -z 0 -R 0 -P 0 -Y 1.570796327" />
      <arg name="robot_name"  value="robot_2" />
    </include>
    <!-- Gmapping Node -->
    <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
      <param name="base_frame" value="/robot_2/Main_Frame"/>
      <param name="odom_frame" value="/robot_2/odom"/>
      <param name="map_frame"  value="/robot_2/map"/>
      <remap from="scan" to="/robot_2/laser/scan"/>
      <remap from="map" to="/robot_2/map" />
      <rosparam command="load" file="$(find jet_slam)/config/gmapping_params.yaml" />
    </node>
    <!-- MoveBase Node -->
    <include file="$(find multi_robot)/config/move_base_setup.launch">
      <arg name="namespace" value="robot_2"/>
    </include>
    <!-- Explore-Lite Node -->
    <include file="$(find multi_robot)/config/exploration_setup.launch">
      <arg name="namespace" value="robot_2"/>
    </include>
  </group>


  <!-- ...........................BEGIN ROBOT 3....................................-->
  <group ns="robot_3">
    <param name="tf_prefix" value="robot_3" />
    <include file="$(find multi_robot)/launch/jet_setup.launch" >
      <arg name="init_pose" value="-x 7 -y -8 -z 0 -R 0 -P 0 -Y -3.141592654" />
      <arg name="robot_name"  value="robot_3" />
    </include>
    <!-- Gmapping Node -->
    <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
      <param name="base_frame" value="/robot_3/Main_Frame"/>
      <param name="odom_frame" value="/robot_3/odom"/>
      <param name="map_frame"  value="/robot_3/map"/>
      <remap from="scan" to="/robot_3/laser/scan"/>
      <remap from="map" to="/robot_3/map" />
      <rosparam command="load" file="$(find jet_slam)/config/gmapping_params.yaml" />
    </node>
    <!-- MoveBase Node -->
    <include file="$(find multi_robot)/config/move_base_setup.launch">
      <arg name="namespace" value="robot_3"/>
    </include>
    <!-- Explore-Lite Node -->
    <include file="$(find multi_robot)/config/exploration_setup.launch">
      <arg name="namespace" value="robot_3"/>
    </include>
  </group>
  
</launch>
